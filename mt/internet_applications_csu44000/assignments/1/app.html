<!-- Import Vue.js distribution -->
<script src="https://npmcdn.com/vue/dist/vue.js"></script>

<!-- HTML code using Vue.js components -->
<div id="app">
    <h1>Welcome to the Magic Weather Predictor</h1>

    Please enter the town you are seeking the forecast of:

    <span v-if="isError">
        <br />
        <br />
        <font color="red">{{errorMessage}}</font>
    </span>

    <br />
    <br />

    Town: <input v-model="town">

    <br />
    <br />

    <button v-on:click="getWeatherForTown">Show me the weather!</button>

    <br />
    <br />

    The forecast is: {{forecastJson}}
</div>

<!-- Vue.js Components -->
<script>
    var app = new Vue({
        el: '#app',
        data: {
            town: '',
            isError: false,
            errorMessage: '',
            forecastJson: {},
            townSearchHistory: []
        },
        methods: {
            getWeatherForTown: getWeatherForTown
        }
    });

    function getWeatherForTown() {
        console.log(`Getting weather for town ${this.town}...`);

        fetch(`http://localhost:3000/forecast/${this.town}`)
            .then(response => {
                // First check that there are no errors
                if (!response.ok)
                    throw Error(response.statusText);

                // If all good, return the json
                return response.json();
            })
            .then(responseJSON => {
                this.forecastJson = responseJSON.result;

                // Reset any errors
                this.isError = false;
                this.errorMessage = '';
            })
            .catch(error => {
                console.error(error);

                // Set error messages
                this.isError = true;
                this.errorMessage = `Unable to fetch weather data for ${this.town}`;
            });
    }
</script>